<!--home.html-->
<!--This line makes use of the already existing base template. We can now override
parts of it.-->
{%extends "base.html"%}
{% block title %}Heat Map{% endblock %}

<!--This will override the base.html content block-->
{% block content %}
  <div class="row" id="row_0">
      <div class="col" id="January">
      </div>
      <div class="col" id="February">
      </div>
      <div class="col" id="March">
      </div>
  </div>
  <div class="row" id="row_1">
      <div class="col" id="April">
      </div>
      <div class="col" id="May">
      </div>
      <div class="col" id="June">
      </div>
  </div>
  <div class="row" id="row_2">
      <div class="col" id="July">
      </div>
      <div class="col" id="August">
      </div>
      <div class="col" id="September">
      </div>
  </div>
  <div class="row" id="row_3">
      <div class="col" id="October">
      </div>
      <div class="col" id="November">
      </div>
      <div class="col" id="December">
      </div>
  </div>





{% endblock %}

{% block javascript %}
    <script>
      // Creates a table
      function createHeatMap(grid_id, days, cell_height){
        const grid = document.getElementById(grid_id);
        const table = document.createElement('table');
        table.setAttribute('id', grid_id + "_table");
        table.setAttribute('class', 'table m-auto');
        table.setAttribute('style', "width: " + (cell_height * 7)+ "px;" + "height: " + (cell_height * 6) + "px");

        var new_row, new_cell;
        
        // Creating Table Rows and Cells
        for (let i = 0; i < Math.ceil((days / 7)); i++){
          new_row = table.insertRow(-1);
          new_row.setAttribute('id', grid_id + '_row_' + i);
          const k = i < 4 ? 7 : (days - (i * 7));
          for (let j = 0; j < k; j++){
            new_cell = new_row.insertCell(-1);
            new_cell.setAttribute('id', grid_id + "_cell_" + ((i * 7) + j));
            new_cell.setAttribute('class', 'border-top border-start border-end border-bottom');
          }
        } 

        // Creating Table Header
        const header = table.createTHead();
        new_row = header.insertRow(0);  
        new_cell = document.createElement('th');
        new_cell.setAttribute("id", grid_id + "_header_cell");
        new_cell.setAttribute("colspan", "7");
        new_row.setAttribute("style", "text-align: center; height: 30px");
        new_cell.innerHTML = grid_id;
        new_row.appendChild(new_cell);

        grid.appendChild(table);
      }

      // Adds Feb 29th to the front end.
      function addFeb29(){
        var table = document.getElementById('February_table');
        var new_row = table.insertRow(-1);
        var new_cell = new_row.insertCell(-1);

        new_cell.setAttribute('class', 'border-top border-start border-end border-bottom');
        new_cell.setAttribute('id', 'February_cell_28');
      }

      // Checks if we are in a leap year by the Gregorian Calendar.
      function isLeapYear() {
        const d = new Date();
        const year = d.getFullYear();
        return (year & 3) == 0 && ((year % 25) != 0 || (year & 15) == 0);
      }

      // The following code only runs if the browser has loaded. NOTE: This is different than the readyState. For some reason, the readyState at this point is still loading.
      window.onload = (event) => {

        let row;
        // Setting a height for the row. Currently all rows will take up 93% of viewport height, or whatever the window.innerHeight value is.
        const row_height_num = Math.floor((window.innerHeight - (window.innerHeight * 0.07)) / 4) 
        const row_height = "height: " + row_height_num + "px";

        // Loops through the rows and set their height, this way it is set dynamically and will function even for mobile users.
        for (let i = 0; i <4; i++){
          row = document.getElementById('row_' + i);
          row.setAttribute('style', row_height);
        }

        const months = {
          "January" : 31,
          "February" : 28,
          "March" : 31,
          "April" : 30,
          "May" : 31,
          "June" : 30,
          "July" : 31,
          "August" : 31,
          "September" : 30,
          "October" : 31,
          "November" : 30,
          "December" : 31,
        }

        // Individual Cell Heights 
        const cell_height = Math.floor(row_height_num / 6);

        // Generates the HTML view for the table we see.
        Object.entries(months).forEach(([key, val]) => {
          createHeatMap(key, val, cell_height);
        })
        

        if (isLeapYear()){
          addFeb29();
        }
      };
    </script>
{% endblock %}